---
title: "Introducing {gtreg}: Solutions"
format: html
---

# Settings

```{r settings}
library(tidyverse)
library(gtsummary)
library(gtreg)
library(admiral)       # for subject level analysis data set     
library(admiral.test)  # for ae data
theme_gtsummary_compact()
```

# The Data

For these exercises we will be using STDM and ADaM datasets from the [{admiral.test}](https://github.com/pharmaverse/admiral.test) and [{admiral}](https://pharmaverse.github.io/admiral/index.html) and packages.


# Exercise 1

Should this be an exercise or provided?

First, prepare a subject level data set named `subjects` from the `admiral_adsl` data set
with only the variables `USUBJID`, `ACTARM`, `AGE`, `SEX`, `RACE` and subjects who screen failed removed.

```{r}
subjects <- admiral_adsl |> 
  select(USUBJID, ACTARM, AGE, SEX, RACE) |> 
  # mutate(across(RACE, str_to_title)) |> 
  filter(ACTARM != "Screen Failure")
```

Next, prepare an adverse event data set named `ae` from `admiral_ae` with the 
only the variables `USUBJID`, `AESOC`, `AEDECOD`, `AESEV`, `AESER`, `AEREL`, `AESTDTC`.
Join actual treatment arm (`ACTARM`) from the `subjects` data frame to the `ae` data.



```{r}
ae <- admiral_ae |> 
  select(USUBJID, AESOC, AEDECOD, AESEV, AESER, AEREL, AESTDTC) |> 
  left_join(subjects |> select(USUBJID, ACTARM), by = "USUBJID") |> 
  filter(AEREL == "PROBABLE")
  # include 3 arms?
  # change capitalization?
```

# Exercise 2

Create an adverse event table saved as `t1` that summarizes adverse events 
by treatment arm and severity using; be sure that the correct subject denominator
is correct.

```{r}
t1 <- ae |>
  tbl_ae(
    id_df = subjects,
    id = USUBJID,
    ae = AEDECOD,
    soc = AESOC,
    by = AESEV,
    strata = ACTARM
  ) |> 
  bold_labels()
```


